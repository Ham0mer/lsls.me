<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Hammer小屋 Blog</title>
        <link>https://lsls.me/blog</link>
        <description>Hammer小屋 Blog</description>
        <lastBuildDate>Sun, 02 Oct 2022 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[v2ray后端节点对接]]></title>
            <link>https://lsls.me/blog/v2ray后端节点对接</link>
            <guid>v2ray后端节点对接</guid>
            <pubDate>Sun, 02 Oct 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1.在V2board后台添加节点]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1在v2board后台添加节点">1.在V2board后台添加节点<a class="hash-link" href="#1在v2board后台添加节点" title="标题的直接链接">​</a></h2><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>新建节点（节点名称自定义，标签自定义，权限组这个在面板中预先设置好，</p><p>没开TLS所以填的IP，传输协议选<code>websocket</code>,就可以提交了</p><p><code>websocket</code>传输协议——编辑配置</p><p>传输协议为 <code>Websocket</code>，必须要点击<code>&lt;传输协议&gt;</code>旁的<code>&lt;编辑配置&gt;</code>，并填写以下内容，<code>path</code> 可以自定义，以 / 开头</p></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"path"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2在后端节点部署">2.在后端节点部署<a class="hash-link" href="#2在后端节点部署" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="先执行">先执行<a class="hash-link" href="#先执行" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一键安装&amp;更新</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -Ls https://blog.sprov.xyz/soga.sh</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="同步时间">同步时间<a class="hash-link" href="#同步时间" title="标题的直接链接">​</a></h3><p>v2ray 节点需要进行时间同步，时间若与客户端相差太大则无法连接</p><p>CentOS </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y ntp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> ntpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ntpdate -q </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.rhel.pool.ntp.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart ntpd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Debian / Ubuntu</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y ntp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> ntp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart ntp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置soga">配置soga<a class="hash-link" href="#配置soga" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/soga/soga.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面是详细的配置参数，可以根据下面参考对应修改</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type=v2board                      # 必填这个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_type=v2ray                 # 必填这个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api=webapi                        # webapi 或 db，表示 webapi 对接或数据库对接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webapi_url=https</span><span class="token operator" style="color:#393A34">:</span><span class="token comment" style="color:#999988;font-style:italic">//www.xxxx.com/  # 这里是填对接的面板地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">webapi_mukey=xxxxxx               # 这里是V2board面板与服务端通讯的密钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_host=db.xxxx.com               # 数据库地址         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_port=</span><span class="token number" style="color:#36acaa">3306</span><span class="token plain">                      # 数据库端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_name=</span><span class="token number" style="color:#36acaa">123</span><span class="token plain">                       # 数据库名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_user=</span><span class="token number" style="color:#36acaa">123</span><span class="token plain">                       # 数据库用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_password=</span><span class="token number" style="color:#36acaa">123456</span><span class="token plain">                # 数据库密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_id=</span><span class="token number" style="color:#36acaa">8</span><span class="token plain">                         # 填面板添加节点对应的的ID号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga_key=                         # 授权key，社区版无需填写，最多支持</span><span class="token number" style="color:#36acaa">88</span><span class="token plain">用户，商业版无限制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert_domain=x5.test.com           # 这里是用到tls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">使用申请证书的域名  （如不使用tls，这行可以删除不用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert_mode=http                    # 申请模式   （如不使用tls，这行可以删除不用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert_key_length=ec</span><span class="token number" style="color:#36acaa">-256</span><span class="token plain">            # 留空则申请RSA证书，填写ec</span><span class="token number" style="color:#36acaa">-256</span><span class="token plain">或ec</span><span class="token number" style="color:#36acaa">-384</span><span class="token plain">则申请ECC证书（如不使用tls，这行可以删除不用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_conn_limit=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                 # 限制用户连接数，</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">代表无限制，v2board 必填！！！ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_speed_limit=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                # 用户限速，</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">代表无限制，单位 Mbps，v2board 必填！！！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_interval=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain">                # 同步前端用户、上报服务器信息等间隔时间（秒），近似值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">force_close_ssl=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">             # 设为</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">可强制关闭tls，即使前端开启tls，soga也不会开启tls，方便用户自行使用nginx、caddy等反代</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">forbidden_bit_torrent=</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">        # 设为</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">可禁用bt下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_dns=</span><span class="token number" style="color:#36acaa">8.8</span><span class="token plain">.</span><span class="token number" style="color:#36acaa">8.8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1.1</span><span class="token plain">.</span><span class="token number" style="color:#36acaa">1.1</span><span class="token plain">       # 配置默认dns，可在此配置流媒体解锁的dns，以逗号分隔</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动后端">启动后端<a class="hash-link" href="#启动后端" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">soga start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="soga管理命令">soga管理命令<a class="hash-link" href="#soga管理命令" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">soga - 显示管理菜单 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">功能更多</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga start - 启动 soga</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga stop - 停止 soga</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga restart - 重启 soga</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga status - 查看 soga 状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga </span><span class="token builtin class-name">enable</span><span class="token plain"> - 设置 soga 开机自启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga disable - 取消 soga 开机自启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga log - 查看 soga 日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga update - 更新 soga</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> - 安装 soga</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soga uninstall - 卸载 soga</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>v2ray</category>
            <category>对接</category>
        </item>
        <item>
            <title><![CDATA[V2board部署]]></title>
            <link>https://lsls.me/blog/V2board部署</link>
            <guid>V2board部署</guid>
            <pubDate>Sun, 02 Oct 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1.配置aaPanel]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1配置aapanel">1.配置aaPanel<a class="hash-link" href="#1配置aapanel" title="标题的直接链接">​</a></h2><p>你需要在 <a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial" target="_blank" rel="noopener noreferrer">aaPanel</a> 选择你的系统获得安装方式。这里以 CentOS 7+ 作为系统环境进行安装。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>请务必使用 CentOS 7+ 安装aaPanel，其他系统可能会有未知问题。</p></div></div><p>安装完成后我们登陆 aaPanel 进行环境的安装。</p><p>选择使用LNMP的环境安装方式勾选如下信息</p><p>☑️ Nginx 1.17</p><p>☑️ MySQL 5.6</p><p>☑️ PHP 7.4</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2安装redisfileinfo">2.安装Redis、fileinfo<a class="hash-link" href="#2安装redisfileinfo" title="标题的直接链接">​</a></h2><p>aaPanel 面板 &gt; App Store &gt; 找到PHP 7.4点击Setting &gt; Install extentions &gt; redis,fileinfo 进行安装。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3解除被禁止的函数">3.解除被禁止的函数<a class="hash-link" href="#3解除被禁止的函数" title="标题的直接链接">​</a></h2><p>aaPanel 面板 &gt; App Store &gt; 找到PHP 7.4点击Setting &gt; Disabled functions 将 <code>putenv</code> <code>proc_open</code> <code>pcntl_alarm</code> <code>pcntl_signal</code> 从列表中删除。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4添加站点">4.添加站点<a class="hash-link" href="#4添加站点" title="标题的直接链接">​</a></h2><p>aaPanel 面板 &gt; Website &gt; Add site。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_S0QG"><p>在 Domain 填入你指向服务器的域名</p><p>在 Database 选择MySQL</p><p>在 PHP Verison 选择PHP-74</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5安装v2board">5.安装V2Board<a class="hash-link" href="#5安装v2board" title="标题的直接链接">​</a></h2><p>通过SSH登录到服务器后访问站点路径如：<code>/www/wwwroot/</code>你的站点域名。</p><p>以下命令都需要在站点目录进行执行。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51安装v2board">5.1.安装V2Board<a class="hash-link" href="#51安装v2board" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 删除目录下文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chattr -i .user.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf .htaccess </span><span class="token number" style="color:#36acaa">404</span><span class="token plain">.html index.html .user.ini</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行命令从 Github 克隆到当前目录。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/v2board/v2board.git ./</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行命令安装依赖包以及V2board</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> init.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据提示完成安装</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6配置站点目录及伪静态">6.配置站点目录及伪静态<a class="hash-link" href="#6配置站点目录及伪静态" title="标题的直接链接">​</a></h2><p>添加完成后编辑添加的站点 &gt; Site directory &gt; Running directory 选择 /public 保存。</p><p>添加完成后编辑添加的站点 &gt; URL rewrite 填入伪静态信息。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location /downloads </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location / </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  try_files </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$uri</span><span class="token plain">/ /index.php</span><span class="token variable" style="color:#36acaa">$is_args</span><span class="token variable" style="color:#36acaa">$query_string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location ~ .*</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">js</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">css</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">?$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expires      1h</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error_log off</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  access_log /dev/null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7配置定时任务">7.配置定时任务<a class="hash-link" href="#7配置定时任务" title="标题的直接链接">​</a></h2><p>aaPanel 面板 &gt; Cron。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_S0QG"><p>在 Type of Task 选择 Shell Script</p><p>在 Name of Task 填写 v2board</p><p>在 Period 选择 N Minutes 1 Minute</p><p>在 Script content 填写 php /www/wwwroot/路径/artisan schedule:run</p></div></div><p>根据上述信息添加每1分钟执行一次的定时任务。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8启动队列服务">8.启动队列服务<a class="hash-link" href="#8启动队列服务" title="标题的直接链接">​</a></h2><p>V2board的系统强依赖队列服务，正常使用V2Board必须启动队列服务。下面以aaPanel中supervisor服务来守护队列服务作为演示。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_S0QG"><p>aaPanel 面板 &gt; App Store &gt; Tools</p><p>找到Supervisor进行安装，安装完成后点击设置 &gt; Add Daemon按照如下填写</p><p>在 Name 填写 <code>V2board</code>
在 Run User 选择 <code>www</code>
在 Run Dir 选择 站点目录 在 <code>Start Command </code>填写 <code>php artisan horizon</code> 在 <code>Processes</code> 填写 1</p><p>填写后点击<code>Confirm</code>添加即可运行。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常见问题">常见问题<a class="hash-link" href="#常见问题" title="标题的直接链接">​</a></h2><p>Q：500错误
A：检查站点根目录权限，递归755，保证目录有可写文件的权限，也有可能是Redis扩展没有安装或者Redis没有按照造成的。你可以通过查看storage/logs下的日志来排查错误或者开启debug模式、站点设置中关闭防跨站。</p>]]></content:encoded>
            <category>V2board</category>
            <category>部署</category>
        </item>
    </channel>
</rss>